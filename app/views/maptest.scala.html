@(currentUserAddress: String)

@main(" - Map Test") {
  <p> You are here: @{currentUserAddress} </p>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
  <link rel="stylesheet" href="/assets/leaflet-routing-machine-2.3.0/leaflet-routing-machine.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="/assets/leaflet-routing-machine-2.3.0/leaflet-routing-machine.js"></script>
  <script src="/assets/leaflet-routing-machine-2.3.0/Control.Geocoder.js"></script>

  <style type="text/css">
    #map { height: 600px; width: 1024px; }
  </style>

  <div id="map"></div>

  <script type="application/javascript">
    // initial view = Hamburg
    var map = L.map('map').setView([53.5502099, 9.9993636], 9);

    // Create pop-up for setting waypoints in map
    function createButton(label, container) {
      var btn = L.DomUtil.create('button', '', container);
      btn.setAttribute('type', 'button');
      btn.innerHTML = label;
      return btn;
    }

    // Add start and destination waypoint from clicking on map
    map.on('click', function(e) {
      var container = L.DomUtil.create('div'),
        startBtn = createButton('Start from this location', container),
        destBtn = createButton('Go to this location', container);

      L.popup()
        .setContent(container)
        .setLatLng(e.latlng)
        .openOn(map);

      L.DomEvent.on(startBtn, 'click', function() {
        control.spliceWaypoints(0, 1, e.latlng);
        map.closePopup();
      });

      L.DomEvent.on(destBtn, 'click', function() {
        control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
        map.closePopup();
      });
    });

    // Get map itself
    // http://{s}.tiles.mapbox.com/v3/MapID/{z}/{x}/{y}.png
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
      maxZoom: 18
    }).addTo(map);

    // Add basic routing control
    var control = L.Routing.control({
      // example route
//      waypoints: [
//        L.latLng(53.56875, 9.98286),
//        L.latLng(53.5571614, 10.023104)
//      ],
      routeWhileDragging: true,
      geocoder: L.Control.Geocoder.nominatim(),
      reverseWaypoints: true
    });

    control.addTo(map);

    // Find user location and move map initially
    L.Control.Geocoder.nominatim().geocode("@{currentUserAddress}", function(results){
      if (results.length > 0) {
        map.panTo(results[0].center);
        map.fitBounds(results[0].bbox);
      }
    });
  </script>
}